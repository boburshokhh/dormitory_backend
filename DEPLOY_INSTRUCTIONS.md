# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ Ubuntu —Å–µ—Ä–≤–µ—Ä

## –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Ä–µ—à–µ–Ω–∞

–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º –º–æ–¥—É–ª–µ–º `axios`, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±–æ–≤–∞–ª—Å—è –¥–ª—è Telegram –ª–æ–≥–≥–µ—Ä–∞. –ú—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏–ª–∏ Telegram –ª–æ–≥–≥–µ—Ä –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã.

## –ß—Ç–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ

1. **–§–∞–π–ª—ã Telegram –ª–æ–≥–≥–µ—Ä–∞:**
   - `services/telegramLoggerService.js`
   - `middleware/telegramLogging.js`
   - `middleware/terminalTelegramLogging.js`

2. **–ö–æ–¥ –∏–∑ server.js:**
   - –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram middleware
   - Middleware –¥–ª—è Telegram –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è Telegram –≤ graceful shutdown

3. **–ö–æ–¥ –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤:**
   - –í—Å–µ –≤—ã–∑–æ–≤—ã `telegramLogger.logUserAction()` –≤ `applicationsController.js`
   - –í—Å–µ –º–µ—Ç–æ–¥—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å Telegram –≤ `logsController.js`

4. **–ú–∞—Ä—à—Ä—É—Ç—ã:**
   - –í—Å–µ Telegram –º–∞—Ä—à—Ä—É—Ç—ã –≤ `routes/logs.js`

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
```bash
ssh root@192.168.1.253
```

### 2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
```bash
cd /home/revenge/apps/gubkin-backend/gubkin-obshaga/backend
```

### 3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã PM2
```bash
pm2 stop gubkin-backend
pm2 delete gubkin-backend
```

### 4. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ git)
```bash
git pull origin main
```

### 5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
npm install --production
```

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
nano .env
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ `.env` –ù–ï–¢ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å Telegram:
- –£–¥–∞–ª–∏—Ç–µ `TELEGRAM_BOT_TOKEN`
- –£–¥–∞–ª–∏—Ç–µ `TELEGRAM_CHAT_ID`
- –£–¥–∞–ª–∏—Ç–µ `TELEGRAM_LOGGING_ENABLED`
- –£–¥–∞–ª–∏—Ç–µ `TELEGRAM_LOG_LEVEL`
- –£–¥–∞–ª–∏—Ç–µ `TELEGRAM_TERMINAL_MODE`

### 7. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–ø—É—Å–∫
```bash
node server.js
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
‚úÖ Database connection established
üì¶ –§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ
üöÄ Server started on port 3000
```

### 8. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ PM2
```bash
pm2 start ecosystem.config.js --env production
```

### 9. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
```bash
pm2 status
pm2 logs gubkin-backend
```

### 10. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2
```bash
pm2 save
pm2 startup
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check
```bash
curl http://localhost:3000/api/health
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
```bash
pm2 logs gubkin-backend --lines 50
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
pm2 monit
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Cannot find module 'axios'"
**–†–µ—à–µ–Ω–∏–µ:** Telegram –ª–æ–≥–≥–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω, —ç—Ç–∞ –æ—à–∏–±–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–ª—è—Ç—å—Å—è.

### –ü—Ä–æ–±–ª–µ–º–∞: "Database connection failed"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ `.env` —Ñ–∞–π–ª–µ.

### –ü—Ä–æ–±–ª–µ–º–∞: "MinIO initialization failed"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MinIO –≤ `.env` —Ñ–∞–π–ª–µ.

### –ü—Ä–æ–±–ª–µ–º–∞: "SSL certificates not found"
**–†–µ—à–µ–Ω–∏–µ:** –í development —Ä–µ–∂–∏–º–µ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –í production –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç–∏ –∫ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
pm2 logs gubkin-backend -f
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
pm2 restart gubkin-backend
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
pm2 restart gubkin-backend --update-env
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
dormitory-backend/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ database.js
‚îÇ   ‚îú‚îÄ‚îÄ fileStorage.js
‚îÇ   ‚îî‚îÄ‚îÄ minio.js
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ applicationsController.js (–±–µ–∑ Telegram –ª–æ–≥–≥–µ—Ä–∞)
‚îÇ   ‚îú‚îÄ‚îÄ filesController.js
‚îÇ   ‚îî‚îÄ‚îÄ logsController.js (–±–µ–∑ Telegram –ª–æ–≥–≥–µ—Ä–∞)
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ auth.js
‚îÇ   ‚îú‚îÄ‚îÄ clientIP.js
‚îÇ   ‚îú‚îÄ‚îÄ logger.js
‚îÇ   ‚îî‚îÄ‚îÄ logging.js
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ applications.js
‚îÇ   ‚îú‚îÄ‚îÄ auth.js
‚îÇ   ‚îú‚îÄ‚îÄ logs.js (–±–µ–∑ Telegram –º–∞—Ä—à—Ä—É—Ç–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ applicationsService.js
‚îÇ   ‚îú‚îÄ‚îÄ filesService.js
‚îÇ   ‚îî‚îÄ‚îÄ notificationService.js
‚îú‚îÄ‚îÄ server.js (–±–µ–∑ Telegram middleware)
‚îî‚îÄ‚îÄ ecosystem.config.js
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –±—ç–∫–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å Telegram –ª–æ–≥–≥–µ—Ä–æ–º. –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã–º–∏, –≤–∫–ª—é—á–∞—è:

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ, –±–µ–∑ Telegram)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã

